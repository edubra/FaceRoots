<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>FaceRoots - Resultado</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            background: #f5f5f5; 
            margin: 0; 
            padding: 0; 
        }
        h1 { 
            color: #000000; 
            margin-top: 20px; 
        }

        .card {
            background: #fff;
            border-radius: 10px;
            margin: 10px auto;
            width: 90%;
            max-width: 800px;
            padding: 15px;
            text-align: left;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .macro-grupo {
            margin: 0 0 5px 0;
            color: #000000;
            font-size: 1.1em;
        }

        .card .details {
            display: none;
            margin-top: 10px;
        }

        .etnia {
            background: #f0f0f0;
            margin: 8px 0;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
        }

        .etnia-nome {
            font-size: 1.2em;
            color: #333;
            font-weight: bold;
        }

        .descricao-etnia {
            font-size: 1em;
            color: #555;
            margin-top: 3px;
            line-height: 1.4;
        }

        .miscigenacao-container {
            width: 90%;
            max-width: 800px;
            margin: 20px auto;
            text-align: center;
        }

        .miscigenacao-titulo {
            font-size: 0.8em;
            color: #000000;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .miscigenacao-bar {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: #ddd;
            border-radius: 20px;
            overflow: hidden;
            height: 25px;
        }

        .miscigenacao-fill {
            background: #4a643d;
            height: 100%;
            width: 0;
            text-align: right;
            color: #fff;
            padding-right: 5px;
            line-height: 25px;
            font-size: 16px;
            font-weight: bold;
            transition: width 1s ease-in-out;
        }

        #map {
            height: 400px;
            width: 90%;
            max-width: 800px;
            margin: 20px auto;
            border-radius: 10px;
            border: 2px solid #ccc;
        }

        .localizacao-titulo {
            width: 90%;
            max-width: 800px;
            margin: 50px auto  auto auto;
            text-align: left;
            font-size: 0.8em;
            font-weight: bold;
            color: #555555;
        }
        
        .semelhanca-titulo {
            width: 90%;
            max-width: 800px;
            margin: 50px auto  auto auto;
            text-align: left;
            font-size: 0.8em;
            font-weight: bold;
            color: #555555;
        }



        /* ✅ Botões de compartilhamento ajustados */
        .share-buttons {
            margin: 100px 100px auto;
            margin-bottom: 100px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            width: 90%;
            max-width: 800px;
        }

        .btn-share {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 48px;
            text-decoration: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-share:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .instagram { background: radial-gradient(circle at 30% 30%, #fdf497 0%, #fd5949 45%, #d6249f 60%, #285AEB 90%); }
        .tiktok { background: linear-gradient(45deg, #69C9D0 0%, #EE1D52 50%, #000000 100%); }
        .whatsapp { background-color: #25d366; }
        .facebook { background-color: #1877f2; }
        .twitter { background-color: #000000; }
        .telegram { background-color: #0088cc; }

        .resultado-img {
            max-width: 300px;
            margin: 20px auto;
            display: block;
            border: 1px solid #ccc;
            border-radius: 10px;
        }

        /* ✅ Botão refazer igual ao de continuar */
        .btn-refazer {
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            text-decoration: none;
            color: #555555;
            font-size: 18px;
            border-radius: 20px;
            width: 200px;
            height: 40px;
            font-weight: bold;
            border: 2px solid #555555;
            transition: 0.3s;
            box-shadow: 0px 6px 0px -2px rgba(67, 145, 209, 1);
            background-color: #90caf9;
            margin: 25px auto;
        }
        .btn-refazer:hover {
            box-shadow: 0 0 #fff;
            transform: translateY(1px);
        }
    </style>
</head>
<body>
    <h1>Resultado do FaceRoots</h1>

    <!-- ✅ 1 - FOTO DA PESSOA -->
    <img src="{{ url_for('static', filename='uploads/' + image_path) }}" 
         alt="Sua Foto" 
         style="max-width:200px; border-radius:10px;">

    <!-- ✅ NOVO TEXTO: maior semelhança -->
    <div class="semelhanca-titulo">Seu fenótipo predominante:</div>

    <!-- ✅ 2 - NOVO CARD: MAIOR SEMELHANÇA -->
    {% set maior_etnia, maior_porcentagem = top3[0] %}
    <div class="card" style="cursor: default;">
            <div class="details" style="display:block;">
            <div class="etnia">
                <div class="etnia-nome">{{ group_labels[maior_etnia]['label'] }} - {{ maior_porcentagem }}%</div>
                <div class="descricao-etnia">{{ group_labels[maior_etnia]['desc'] }}</div>
            </div>
        </div>
    </div>

    <!-- ✅ NOVO TEXTO: ONDE ESTÃO LOCALIZADOS -->
    <div class="localizacao-titulo">Chance de haver esta Etnia em seu DNA:</div>

    <!-- ✅ 3 - CARDS ANTIGOS -->
    {% for macro, score in macro_sorted %}
    <div class="card" onclick="toggleDetails('{{ macro }}')">
        <h3 class="macro-grupo">{{ macro }} - {{ score }}%</h3>
        <div class="details" id="details-{{ macro }}">
            {% for etnia, etnia_score in detailed_groups[macro] %}
            <div class="etnia" onclick="focusEtnia('{{ group_labels[etnia]['lat'] }}', '{{ group_labels[etnia]['lon'] }}', '{{ group_labels[etnia]['label'] }}')">
                <div class="etnia-nome">{{ group_labels[etnia]['label'] }} - {{ etnia_score }}%</div>
                <div class="descricao-etnia">{{ group_labels[etnia]['desc'] }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <!-- ✅ 4 - MAPA -->
    <div id="map"></div>

    <!-- ✅ 5 - MISCIGENAÇÃO -->
    <div class="miscigenacao-container">
        <p class="miscigenacao-titulo">Miscigenação: {{ miscigenacao }}%</p>
        <div class="miscigenacao-bar">
            <div id="barra-miscigenacao"
                style="height: 100%; width: {{ miscigenacao }}%;
                        background: linear-gradient(to right, 
                            rgba(0,128,255,1) 0%, 
                            rgba(0,255,0,1) 50%, 
                            rgba(255,165,0,1) 100%);">
            </div>
        </div>
    </div>

    <!-- ✅ 6 - BOTÕES DE COMPARTILHAMENTO -->
    <div class="share-buttons">
        <a class="btn-share instagram" href="https://www.instagram.com/" target="_blank"><i class="fab fa-instagram"></i></a>
        <a class="btn-share tiktok" href="https://www.tiktok.com/" target="_blank"><i class="fab fa-tiktok"></i></a>
        <a class="btn-share whatsapp" href="https://api.whatsapp.com/send?text=Olha%20meu%20resultado%20no%20FaceRoots!%20{{ request.host_url }}faceroots/static/uploads/{{ img_compartilhavel }}" target="_blank"><i class="fab fa-whatsapp"></i></a>
        <a class="btn-share facebook" href="https://www.facebook.com/sharer/sharer.php?u={{ request.host_url }}faceroots/static/uploads/{{ img_compartilhavel }}" target="_blank"><i class="fab fa-facebook-f"></i></a>
        <a class="btn-share twitter" href="https://twitter.com/intent/tweet?text=Olha%20meu%20resultado%20no%20FaceRoots!&url={{ request.host_url }}faceroots/static/uploads/{{ img_compartilhavel }}" target="_blank"><i class="fab fa-x-twitter"></i></a>
        <a class="btn-share telegram" href="https://t.me/share/url?url={{ request.host_url }}faceroots/static/uploads/{{ img_compartilhavel }}" target="_blank"><i class="fab fa-telegram-plane"></i></a>
    </div>

    <!-- ✅ 7 - IMAGEM DE COMPARTILHAMENTO -->
    <!-- <img src="{{ url_for('static', filename='uploads/' + img_compartilhavel) }}" class="resultado-img"> -->

    <!-- ✅ 8 - BOTÃO REFAZER -->
    <a class="btn-refazer" href="/">Refazer o Teste</a>

        <!-- ✅ 9 - DISCLAIMER -->
    <div class="card" style="font-size: 1rem; color:#555555; cursor:default; margin-top:40px;">
        <div id="disclaimer-container" style="overflow:hidden; max-height:70px; transition:max-height 0.5s ease;">
            <p>
                O <strong>FaceRoots</strong> utiliza técnicas de <strong>Machine Learning</strong> e 
                <strong>Visão Computacional</strong> para analisar imagens faciais e 
                <strong>estimar o fenótipo predominante</strong> de um indivíduo com base em padrões visuais comparados 
                a um banco de dados diversificado de rostos humanos. O sistema aplica modelos de 
                <strong>Redes Neurais Convolucionais (CNNs)</strong>, treinadas com imagens rotuladas de diferentes 
                grupos populacionais, para reconhecer traços faciais característicos e associá-los a 
                <strong>categorias fenotípicas amplas</strong>.<br><br>

                <span id="disclaimer-more">
                    É importante ressaltar que:<br>
                    - O resultado gerado é <strong>puramente estatístico</strong> e reflete apenas 
                    <strong>padrões visuais probabilísticos</strong>, não representando de forma exata ou definitiva 
                    a origem genética do usuário.<br>
                    - Fenótipo não é sinônimo de <strong>ancestralidade genética</strong>. Diversos fatores, como 
                    mistura populacional, expressão genética individual e até condições ambientais, influenciam 
                    a aparência.<br>
                    - O FaceRoots <strong>não armazena imagens permanentemente</strong>, e os dados processados seguem 
                    padrões básicos de privacidade, sendo utilizados apenas para gerar o resultado imediato.<br>
                    - Este aplicativo deve ser utilizado <strong>exclusivamente para entretenimento e curiosidade pessoal</strong>, 
                    <strong>não</strong> servindo para fins médicos, científicos ou decisões de qualquer natureza sensível.<br><br>
                    Para quem busca um <strong>resultado preciso sobre ancestralidade genética</strong>, recomendamos 
                    realizar um <strong>teste de DNA com empresas especializadas</strong>, como o <strong>Genera</strong>, 
                    que oferece análises detalhadas baseadas em marcadores genéticos.
                </span>
            </p>
        </div>
        <a href="#" id="disclaimer-toggle" 
           style="color:#555555; text-decoration:underline; font-size:1.2rem; display:inline-block; margin-top:5px;">
           Leia mais
        </a>
    </div>

    <script>
        const toggle = document.getElementById('disclaimer-toggle');
        const container = document.getElementById('disclaimer-container');
        let expanded = false;

        toggle.addEventListener('click', function (e) {
            e.preventDefault();
            expanded = !expanded;
            if (expanded) {
                container.style.maxHeight = container.scrollHeight + "px";
                toggle.textContent = "Mostrar menos";
            } else {
                container.style.maxHeight = "70px";
                toggle.textContent = "Leia mais";
            }
        });
    </script>


    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([20,0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        var macroGroups = {{ macro_sorted|tojson }};
        var colors = ['red','blue','green','orange','purple','brown'];
        macroGroups.forEach((group, index) => {
            let coords = { 
                "EUROPA": [54, 15],
                "ÁSIA": [30, 90],
                "ÁFRICA": [0, 20],
                "AMÉRICA INDÍGENA": [0, -60],
                "ORIENTE MÉDIO": [25, 45],
                "OCEANIA": [-15, 140]
            }[group[0]] || [0,0];

            L.circle(coords, {
                color: colors[index % colors.length],
                fillColor: colors[index % colors.length],
                fillOpacity: 0.4,
                radius: group[1] * 10000
            }).addTo(map).bindPopup(group[0] + ": " + group[1] + "%");
        });

        function focusEtnia(lat, lon, label) {
            map.setView([parseFloat(lat), parseFloat(lon)], 5);
            L.marker([parseFloat(lat), parseFloat(lon)]).addTo(map).bindPopup(label).openPopup();
        }

        function toggleDetails(macro) {
            var details = document.getElementById("details-" + macro);
            details.style.display = (details.style.display === "block") ? "none" : "block";
        }
    </script>
</body>
</html>
